<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MQTT Web Client - HiveMQ Cloud</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h2>MQTT Web Client (HiveMQ Cloud)</h2>

  <label for="msg">Nh·∫≠p gi√° tr·ªã:</label>
  <input type="text" id="msg" placeholder="Nh·∫≠p d·ªØ li·ªáu">
  <button onclick="sendMsg()">G·ª≠i MQTT</button>

  <p id="status">Tr·∫°ng th√°i: ƒêang k·∫øt n·ªëi...</p>
  <div id="received"></div>

  <script>
    // C·∫•u h√¨nh k·∫øt n·ªëi HiveMQ Cloud
    const options = {
      username: "Son75Son75",
      password: "Son75Son75",
      clean: true,
      connectTimeout: 4000,
      reconnectPeriod: 1000
    };

    // K·∫øt n·ªëi b·∫±ng WebSocket Secure (port 8884)
    const client = mqtt.connect(
      "wss://f1e5f5ad51204b15b4b3931fe01978ae.s1.eu.hivemq.cloud:8884/mqtt",
      options
    );

    client.on("connect", function () {
      document.getElementById("status").innerText = "‚úÖ ƒê√£ k·∫øt n·ªëi HiveMQ Cloud";

      // Subscribe th·ª≠ ƒë·ªÉ nh·∫≠n l·∫°i d·ªØ li·ªáu ƒë√£ g·ª≠i
      client.subscribe("factory/line1/cmd");
    });

    client.on("error", function (err) {
      document.getElementById("status").innerText = "‚ùå L·ªói k·∫øt n·ªëi: " + err;
    });

    client.on("message", function (topic, message) {
      document.getElementById("received").innerHTML =
        "üì• Nh·∫≠n t·ª´ " + topic + ": " + message.toString();
    });

    // H√†m g·ª≠i d·ªØ li·ªáu
    function sendMsg() {
      const msg = document.getElementById("msg").value;
      if (msg) {
        client.publish("factory/line1/cmd", msg);
        alert("ƒê√£ g·ª≠i: " + msg);
      } else {
        alert("Vui l√≤ng nh·∫≠p gi√° tr·ªã tr∆∞·ªõc khi g·ª≠i!");
      }
    }
  </script>
</body>
</html>
