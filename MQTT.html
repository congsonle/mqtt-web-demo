<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MQTT Auto Publisher</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h2>MQTT Auto Publisher (HiveMQ Cloud)</h2>
  <p id="status">Tr·∫°ng th√°i: ƒêang k·∫øt n·ªëi...</p>
  <p>Gi√° tr·ªã hi·ªán t·∫°i: <span id="value">0</span></p>
  <div id="received"></div>

  <script>
    // C·∫•u h√¨nh k·∫øt n·ªëi HiveMQ Cloud
    const options = {
      username: "Son75Son75",
      password: "Son75Son75",
      clean: true,
      connectTimeout: 4000,
      reconnectPeriod: 1000
    };

    // K·∫øt n·ªëi WebSocket Secure (port 8884)
    const client = mqtt.connect(
      "wss://f1e5f5ad51204b15b4b3931fe01978ae.s1.eu.hivemq.cloud:8884/mqtt",
      options
    );

    client.on("connect", function () {
      document.getElementById("status").innerText = "‚úÖ ƒê√£ k·∫øt n·ªëi HiveMQ Cloud";

      // Subscribe ƒë·ªÉ xem l·∫°i d·ªØ li·ªáu m√¨nh publish
      client.subscribe("factory/line1/cmd");

      // B·∫Øt ƒë·∫ßu g·ª≠i d·ªØ li·ªáu t·ª± ƒë·ªông
      startAutoPublish();
    });

    client.on("error", function (err) {
      document.getElementById("status").innerText = "‚ùå L·ªói k·∫øt n·ªëi: " + err;
    });

    client.on("message", function (topic, message) {
      const div = document.getElementById("received");
      div.innerHTML =
        "üì• Nh·∫≠n t·ª´ " + topic + ": " + message.toString();
    });

    // Bi·∫øn ƒë·∫øm t·ª± ƒë·ªông
    let counter = 0;
    function startAutoPublish() {
      setInterval(() => {
        client.publish("factory/line1/cmd", counter.toString());
        document.getElementById("value").innerText = counter;

        counter++;
        if (counter > 100) counter = 0;
      }, 1000); // 1000ms = 1 gi√¢y
    }
  </script>
</body>
</html>
